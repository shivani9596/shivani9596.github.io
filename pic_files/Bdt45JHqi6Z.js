/*!CK:3167677992!*//*1444015884,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["clunI"]); }

__d('canUseReactEditor',['UserAgent'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=typeof b.getSelection==='function',j=i&&((h.isPlatform('iOS')||h.isPlatform('Linux')||h.isPlatform('Mac OS X')||h.isPlatform('Windows')||h.isPlatform('Chrome OS'))&&(h.isBrowser('Chrome')||h.isBrowser('Edge >= 12')||h.isBrowser('Firefox >= 16')||h.isBrowser('IE >= 9')||h.isBrowser('Opera >= 12')||h.isBrowser('Mobile Safari >= 6')||h.isBrowser('Safari >= 5')));function k(){return j;}f.exports=k;},null);
__d('applyEmoticonToContentBlock',['CharacterMetadata','DraftEntity','EmoticonsList','immutable'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=k.List,m='\u3000';function n(o,p,q){if(!j.emotes[p])return o;var r=i.create('EMOTICON','IMMUTABLE',{type:j.emotes[p],originalEmoticon:p}),s=o.getText(),t=o.getCharacterList(),u=p.length,v=t.get(q);return o.merge({text:s.slice(0,q)+m+s.slice(q+u),characterList:t.slice(0,q).concat(l.of(h.applyEntity(v,r)),t.slice(q+u))});}f.exports=n;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=new RegExp(h.regexp.source,'g');function l(m,n){var o=n.getAnchorKey(),p=n.getAnchorOffset(),q=m.getBlockForKey(o),r=j(q,p),s,t;while(t!==null){t=k.exec(r);if(t!==null)s=t;}if(!s)return m;var u=s[1];if(!u&&p!==r.length)return m;var v=s[2],w=p-r.length,x=w+s.index+s[1].length,y=m.getBlockMap().set(o,i(q,v,x));p-=v.length-1;return m.merge({blockMap:y,selectionBefore:n,selectionAfter:n.merge({anchorOffset:p,focusOffset:p})});}f.exports=l;},null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=new RegExp(/[\s'".,!?]/);function l(m,n){var o=m.getSelection();if(!o.isCollapsed()||!n||!k.test(n))return m;var p=m.getCurrentContent(),q=j(p,o);if(q===p)return m;var r=h.insertText(q,q.getSelectionAfter(),n);return i.push(m,r,'insert-characters');}f.exports=l;},null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){var m=l.getCurrentContent(),n=l.getSelection(),o=j(m,n);if(o===m)return l;var p=h.splitBlock(o,o.getSelectionAfter());return i.push(l,p,'split-block');}f.exports=k;},null);
__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return j.which===h.RETURN&&(j.getModifierState('Shift')||j.getModifierState('Alt')||j.getModifierState('Control'));}f.exports=i;},null);
__d('UFIMentionsInput.react',['Arbiter','BanzaiScuba','Bootloader','DraftEntity','DraftModifier','DOMVector','EditorState','Input','Keys','MentionsInput.react','React','ReactDOM','SelectionState','UFIUIEvents','URI','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createMentionEntity','cx','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja=new i('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),ka=200,la='ufi_comment_composer',ma='ufi_reply_composer',na=w(),oa=r.PropTypes;function pa(ta){var ua=ta.map(function(va){return {kind:'file',type:va.type,getAsFile:ba.thatReturns(va)};});return {clipboardData:{items:ua}};}function qa(ta){var ua=/^image\//;return ta.filter(function(va){return ua.test(va.type);});}var ra=r.createClass({displayName:'UFIMentionsInput',propTypes:{onContentChange:oa.func},getInitialState:function(){var ta='',ua=[];if(this.props.initialData){ta=this.props.initialData.value||'';ua=this.props.initialData.mentions||[];ua=ua.map(function(wa){return babelHelpers._extends({},wa,{entity:{uid:wa.uid,weakreference:wa.weakreference}});});}var va=y({text:ta,ranges:ua,decorator:ca(),entityCreationFn:sa});va=n.moveSelectionToEnd(va);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:va,mentionsSource:null,mentionableEntries:null,fallbackText:ta};},hasEnteredText:function(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},focus:function(){this._triggerFullRender((function(){if(na){this.refs.mentionsInput.focus();}else s.findDOMNode(this.refs.textarea).focus();}).bind(this));},submitComment:function(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function(ta){this._triggerFullRender((function(){if(na){var ua=this.state.editorState,va=ua.getSelection(),wa=ua.getCurrentContent(),xa=va.getStartKey(),ya=va.getStartOffset(),za=wa.getBlockForKey(xa),ab;if(za.getText().substr(ya-1,1).trim().length>0){var bb=l.replaceText(wa,va,' ');va=bb.getSelectionAfter();ab=l.insertText(bb,va,ta.getTitle(),ua.getCurrentInlineStyle(),z(ta));}else ab=l.replaceText(wa,va,ta.getTitle(),ua.getCurrentInlineStyle(),z(ta));va=ab.getSelectionAfter();ab=l.insertText(ab,va,' ');ua=n.push(ua,ab,'insert-fragment');ua=n.forceSelection(ua,ua.getSelection());this.setState({editorState:ua});this.focus();}else{s.findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+ta.title});}else this.setState({fallbackText:ta.title});}}).bind(this));},insertEmoticon:function(ta){if(!na){this.setState({fallbackText:this.state.fallbackText+' '+ta});return;}var ua=this.state.editorState,va=ua.getCurrentContent(),wa=ua.getSelection(),xa=va.getBlockForKey(wa.getStartKey()).getText()[wa.getStartOffset()-1];if(xa&&xa!==' ')ta=' '+ta;var ya=va.getBlockForKey(wa.getEndKey()).getText()[wa.getEndOffset()];if(ya&&ya!==' ')ta+=' ';var za=l.replaceText(ua.getCurrentContent(),ua.getSelection(),ta);ua=n.push(ua,za,'insert-characters');ua=n.forceSelection(ua,ua.getSelection());this.setState({editorState:ua});},setSignature:function(ta){setTimeout((function(){var ua=this.state.editorState,va=ua.getSelection(),wa=ua.getCurrentContent(),xa=wa.getBlockMap().first(),ya=xa.getKey();va=new t({anchorKey:ya,anchorOffset:0,focusKey:ya,focusOffset:ta.length});wa=l.replaceText(wa,va,ta);ua=n.set(ua,{currentContent:wa});this.setState({editorState:ua});}).bind(this),0);},_informHeightChange:function(){if(this.props.monitorHeight)ia((function(){if(!this.isMounted())return;var ta=na?s.findDOMNode(this.refs.mentionsInput):s.findDOMNode(this.refs.textarea),ua=m.getElementDimensions(ta).y;if(ua!==this._height){this._height=ua;h.inform(u.InputHeightChanged,{node:ta});}}).bind(this));},_onChange:function(ta){if(this.props.onContentChange){var ua=this.state.editorState.getCurrentContent(),va=ta.getCurrentContent();if(ua!==va)this.props.onContentChange(va.hasText());}this.setState({editorState:ta},this._informHeightChange);},_clearDocumentState:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var ta=n.createEmpty(ca());this.setState({editorState:n.moveFocusToEnd(ta)});},_handleContentReturn:function(ta){if(ha(ta)){var ua=ga(this.state.editorState);if(ua===this.state.editorState){return false;}else{this.setState({editorState:ua});return true;}}if(this._submitComment(ta)){this._clearDocumentState();return true;}return false;},_handleBeforeInput:function(ta){var ua=fa(this.state.editorState,ta);if(ua===this.state.editorState){return false;}else{this.setState({editorState:ua});return true;}},_submitComment:function(ta){var ua=this.state.editorState.getCurrentContent(),va=ea(ua),wa=da(ua),xa={visibleValue:va,encodedValue:wa},ya=o.getValue(s.findDOMNode(this.refs.proxyInput));if(ya){var za=new v(b.location.href);ja.addNormal('path',za.getPath());ja.addNormal('proxy_value',ya.substr(0,ka));ja.post();}return this.props.onEnterSubmit(xa,ta);},_handleFiles:function(ta){var ua=qa(ta);if(ua.length){this.props.onPaste(pa(ua));return true;}return false;},_handleDroppedFiles:function(ta,ua){return this._handleFiles(ua);},_handlePastedFiles:function(ta){return this._handleFiles(ta);},_onMentionsInputBlur:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();h.inform(u.Blur,{hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;if(this.props.showBusinessTypeahead){j.loadModules(["TypeaheadMetricReporter","getBusinessMentionsSearchSource"],(function(ta,ua){if(!this.isMounted())return;var va=new ta({event_name:'tinder_mentions'});va.sessionStart();var wa=ua(va,this.props.ftEntIdentifier);wa.bootstrap();this.setState({typeaheadReporter:va,bootloaded:true,mentionsSource:wa},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else j.loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],(function(ta,ua){if(!this.isMounted())return;var va=new ta({event_name:'tinder_mentions'});va.sessionStart();var wa=ua(this.props.datasource,va,this.props.showHashtagTypeahead);wa.bootstrap();this.setState({typeaheadReporter:va,bootloaded:true,mentionsSource:wa},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();h.inform(u.Focus);},_onShowMentions:function(ta,ua){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(ta.map(function(va){return va.getUniqueID();}));},_onAddMention:function(ta,ua,va){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(ta.getUniqueID(),ta.getType(),ua,va.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function(ta){if(ta.which!==p.RETURN)return;if(ha(ta)||!this.state.fallbackText.trim())return;ta.preventDefault();var ua={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(ua,ta))this.setState({fallbackText:''});},_onFallbackChange:function(ta){this.setState({fallbackText:ta.target.value});},_onFallbackBlur:function(ta){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function(ta){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function(ta,ua){var va=ta.getAuxiliaryData().renderType,wa=ua.getAuxiliaryData().renderType;if(va===wa)return ta.getOrder()-ua.getOrder();var xa=this.props.viewOptionsTypeObjectsOrder;return xa.indexOf(va)-xa.indexOf(wa);},_triggerFullRender:function(ta){this.setState({fullRender:true},ta);},_triggerFullRenderWithoutCallback:function(){this._triggerFullRender();},_renderFallback:function(){return (r.createElement('div',null,r.createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function(){if(!this.props.hideProxyInput){var ta="_1osa mentionsHidden";return (r.createElement('input',{className:ta,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function(){var ta="UFIAddCommentInput _1osb _1osc";return (r.createElement('div',{onFocus:this._triggerFullRenderWithoutCallback,onSelect:ba,onClick:this._triggerFullRenderWithoutCallback,onTouchStart:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback},this._renderProxyInput(),r.createElement('div',{className:ta},this.props.placeholder)));},_onClickEditorContainer:function(ta){x('ufi',ta.target,null,'FORCE');},_renderMentionsInput:function(){var ta="UFIAddCommentInput _1osb",ua=babelHelpers._extends({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (r.createElement('div',{onClick:this._onClickEditorContainer},this._renderProxyInput(),r.createElement(q,{ref:'mentionsInput',className:ta,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:ua,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,webDriverTestID:this.props.replyCommentID?ma:la})));},componentDidMount:function(){if(!na){if(this.state.fallbackText)s.findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())ia((function(){this.isMounted()&&this.focus();}).bind(this));},render:function(){if(!na)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function sa(ta){return k.create('MENTION','IMMUTABLE',{id:ta.uid,isWeak:ta.weakreference});}f.exports=ra;},null);