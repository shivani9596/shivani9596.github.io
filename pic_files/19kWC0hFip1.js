/*!CK:3271037152!*//*1442806725,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gc5Dc"]); }

__d('ReactComposerPhotoUploader',['ReactComposerLoggingStore','ReactComposerMediaConfig','ReactComposerPhotoActions','ReactComposerPhotoUploadActions','ReactComposerPhotoUploadStore','ActorURI','AsyncUploadRequest','FaceRecognitionController','JpegResizer','Map','XComposerPhotoUploader','performanceNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();function t(u,v,w){this.$ReactComposerPhotoUploader1=u.composerID;this.$ReactComposerPhotoUploader2=w;var x=i.photo,y=null;if(p.isSupported()){y=p.getSingleton(v>1?p.DEFAULT_POOL_SIZE:1);y.setHighQuality(x.highQuality);}else k.resizerUnavailable(this.$ReactComposerPhotoUploader1);var z=m.create(x.uploadEndpoint,u.actorID);this.$ReactComposerPhotoUploader3=new r({uploadEndpoint:z,uploadData:Object.assign({qn:h.getSessionID(this.$ReactComposerPhotoUploader1),target_id:u.targetID},x.uploadData),retryLimit:x.retryLimit,concurrentLimit:x.concurrentLimit,resizer:y,onUploadEnqueued:this.$ReactComposerPhotoUploader4.bind(this),onResizeStart:this.$ReactComposerPhotoUploader5.bind(this),onResizeSuccess:this.$ReactComposerPhotoUploader6.bind(this),onResizeFailure:this.$ReactComposerPhotoUploader7.bind(this),onResizeProgress:this.$ReactComposerPhotoUploader8.bind(this),onUploadStart:this.$ReactComposerPhotoUploader9.bind(this),onUploadProgress:this.$ReactComposerPhotoUploader10.bind(this),onUploadSuccess:this.$ReactComposerPhotoUploader11.bind(this),onUploadFailure:this.$ReactComposerPhotoUploader12.bind(this)});this.$ReactComposerPhotoUploader13=new o({include_unrecognized_faceboxes:true,include_low_confidence_recognitions:true,include_face_crop_src:true});this.$ReactComposerPhotoUploader13.subscribe('photo',this.$ReactComposerPhotoUploader14.bind(this)),this.$ReactComposerPhotoUploader13.subscribe('done',this.$ReactComposerPhotoUploader15.bind(this));this.$ReactComposerPhotoUploader16=new q();}t.prototype.upload=function(u){this.$ReactComposerPhotoUploader3.upload(u);};t.prototype.retry=function(u){var v=this.$ReactComposerPhotoUploader3.getAsyncUploadRequest([u]);v.send();};t.prototype.getAsyncUploadRequest=function(u,v){return this.$ReactComposerPhotoUploader3.getAsyncUploadRequest(u,v);};t.prototype.enqueueAsyncUploadRequest=function(u,v,w){v.forEach(function(x){var y=w.indexMap?w.indexMap.get(x.uploadID):l.getUploads(u).size;k.enqueue(u,x.uploadID,x.filename,y);});this.getAsyncUploadRequest(v,w).send();};t.prototype.isUploadLimitExceeded=function(u,v){var w=this.getMaxSelectableFilesCount(u),x=!v||!n.isSupported()?1:v.length;return x>w;};t.prototype.getMaxSelectableFilesCount=function(u){return !!u?i.photo.limit:1;};t.prototype.$ReactComposerPhotoUploader4=function(u){k.enqueue(this.$ReactComposerPhotoUploader1,u.uploadID,u.fileName,l.getUploads(this.$ReactComposerPhotoUploader1).size);};t.prototype.$ReactComposerPhotoUploader5=function(u){k.startResizing(this.$ReactComposerPhotoUploader1,u.uploadID,{bytes:u.size});};t.prototype.$ReactComposerPhotoUploader8=function(u,event){setTimeout((function(){return k.progressResizing(this.$ReactComposerPhotoUploader1,u,100*event.written/event.total);}).bind(this),0);};t.prototype.$ReactComposerPhotoUploader6=function(u,v,w,x){k.doneResizing(this.$ReactComposerPhotoUploader1,u.uploadID,{dt:x,media_data_size:u.size,bytes:v.size,custom_tags:{skipped_resizing:w}});};t.prototype.$ReactComposerPhotoUploader7=function(u,v,w,x){k.failResizing(this.$ReactComposerPhotoUploader1,u.uploadID,{dt:x,bytes:u.size,error_code:w.code,error_info:w.message});};t.prototype.$ReactComposerPhotoUploader9=function(u,v){k.startUploading(this.$ReactComposerPhotoUploader1,u,v.upload);this.$ReactComposerPhotoUploader16.set(u,s());};t.prototype.$ReactComposerPhotoUploader10=function(u,v){setTimeout((function(){return k.progressUploading(this.$ReactComposerPhotoUploader1,u,100*v.event.loaded/v.event.total);}).bind(this),0);};t.prototype.$ReactComposerPhotoUploader11=function(u,v){if(l.getHasUploadBeenRemoved(this.$ReactComposerPhotoUploader1,u))return;var w=v.response.payload;k.doneUploading(this.$ReactComposerPhotoUploader1,u,v.upload,s()-this.$ReactComposerPhotoUploader16.get(u),w.photoID,w.thumbSrc,w.originalPhotoID,w.mediaLocation);if(!this.$ReactComposerPhotoUploader2.disableFaceRecognition){j.startRecognizing(this.$ReactComposerPhotoUploader1,w.photoID);this.$ReactComposerPhotoUploader13.start([w.photoID]);}};t.prototype.$ReactComposerPhotoUploader12=function(u,v,w){if(l.getHasUploadBeenRemoved(this.$ReactComposerPhotoUploader1,u))return;var x=v.response,y={code:x.getError(),description:x.getErrorDescription(),summary:x.getErrorSummary(),transient:x.isTransient()||x.getError()==1004||x.getError()==1006};k.failUploading(this.$ReactComposerPhotoUploader1,u,v.upload,s()-this.$ReactComposerPhotoUploader16.get(u),y);};t.prototype.$ReactComposerPhotoUploader14=function(u,v){v.faceboxes.forEach((function(w){var x;if(w.recognitions.length>0){var y=w.recognitions[0].user;x={subjectID:y.fbid,value:y.name};}j.addFacebox(this.$ReactComposerPhotoUploader1,v.photo,{id:w.fbid,x:w.x,y:w.y,top:w.top,left:w.left,width:w.width,height:w.height,croppedURI:w.src,bestRecognition:x,allRecognitions:w.allRecognitions});}).bind(this));j.finishRecognizingPhoto(this.$ReactComposerPhotoUploader1,v.photo);};t.prototype.$ReactComposerPhotoUploader15=function(u,v){j.finishRecognizing(this.$ReactComposerPhotoUploader1,v.unresolved);};f.exports=t;},null);